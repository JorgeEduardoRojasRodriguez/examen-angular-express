<div class="product-list-container">
  <div class="header">
    <div class="header-title">
      <h1>Productos</h1>
      <span class="badge-sql">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
          <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
          <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        </svg>
        SQL
      </span>
    </div>
    <div class="header-actions">
      <input
        type="text"
        placeholder="Buscar producto..."
        class="search-input"
        (input)="onSearch($event)"
      />
      <select class="filter-select" (change)="onCategoryFilter($event)">
        <option value="all">Todas las categorías</option>
        @for (cat of categories; track cat) {
          <option [value]="cat">{{ cat }}</option>
        }
      </select>
      <button class="btn btn-primary" (click)="openCreateModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Nuevo Producto
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="products-grid">
      @for (i of [1,2,3,4,5,6]; track i) {
        <div class="product-card skeleton-card">
          <div class="skeleton skeleton-image"></div>
          <div class="skeleton skeleton-title"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-price"></div>
        </div>
      }
    </div>
  }

  @else if (filteredProducts().length === 0) {
    <div class="state-container">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5">
        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <path d="M16 10a4 4 0 0 1-8 0"></path>
      </svg>
      <p>No hay productos registrados</p>
      <p class="empty-hint">Crea tu primer producto para comenzar</p>
    </div>
  }

  @else {
    <div class="products-grid">
      @for (product of filteredProducts(); track product.id) {
        <div class="product-card" [class.inactive]="!product.isActive">
          <div class="product-header">
            <span class="category-badge">{{ product.category }}</span>
            <div class="product-actions">
              <button class="btn-icon" (click)="openEditModal(product)" title="Editar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
              <button class="btn-icon delete" (click)="deleteProduct(product)" title="Eliminar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </div>
          </div>
          <h3 class="product-name">{{ product.name }}</h3>
          <p class="product-description">{{ product.description || 'Sin descripción' }}</p>
          <div class="product-footer">
            <span class="product-price">{{ formatPrice(product.price) }}</span>
            <span class="product-stock" [class.low-stock]="product.stock < 10">
              Stock: {{ product.stock }}
            </span>
          </div>
          <button
            class="btn-toggle"
            [class.active]="product.isActive"
            (click)="toggleActive(product)"
          >
            {{ product.isActive ? 'Activo' : 'Inactivo' }}
          </button>
        </div>
      }
    </div>

    @if (totalPages() > 1) {
      <div class="pagination">
        <button
          class="btn-page"
          [disabled]="currentPage() === 1"
          (click)="goToPage(currentPage() - 1)"
        >
          Anterior
        </button>
        <span class="page-info">
          Página {{ currentPage() }} de {{ totalPages() }}
        </span>
        <button
          class="btn-page"
          [disabled]="currentPage() === totalPages()"
          (click)="goToPage(currentPage() + 1)"
        >
          Siguiente
        </button>
      </div>
    }
  }

  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ editingProduct() ? 'Editar Producto' : 'Nuevo Producto' }}</h2>
          <button class="btn-close" (click)="closeModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="name">Nombre *</label>
            <input
              type="text"
              id="name"
              [(ngModel)]="form.name"
              placeholder="Nombre del producto"
            />
          </div>
          <div class="form-group">
            <label for="description">Descripción</label>
            <textarea
              id="description"
              [(ngModel)]="form.description"
              placeholder="Descripción del producto"
              rows="3"
            ></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="price">Precio *</label>
              <input
                type="number"
                id="price"
                [(ngModel)]="form.price"
                min="0"
                step="0.01"
                placeholder="0.00"
              />
            </div>
            <div class="form-group">
              <label for="stock">Stock *</label>
              <input
                type="number"
                id="stock"
                [(ngModel)]="form.stock"
                min="0"
                placeholder="0"
              />
            </div>
          </div>
          <div class="form-group">
            <label for="category">Categoría</label>
            <select id="category" [(ngModel)]="form.category">
              @for (cat of categories; track cat) {
                <option [value]="cat">{{ cat }}</option>
              }
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
          <button
            class="btn btn-primary"
            (click)="saveProduct()"
            [disabled]="saving()"
          >
            @if (saving()) {
              <span class="btn-spinner"></span>
              Guardando...
            } @else {
              {{ editingProduct() ? 'Actualizar' : 'Crear' }}
            }
          </button>
        </div>
      </div>
    </div>
  }
</div>
