<div class="note-list-container">
  <header class="header">
    <div class="header-title">
      <h1>Notas</h1>
      <span class="badge-firebase">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
          <path d="M2 17l10 5 10-5"></path>
          <path d="M2 12l10 5 10-5"></path>
        </svg>
        Firebase Firestore
      </span>
    </div>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Nueva Nota
    </button>
  </header>

  @if (isLoading()) {
    <div class="notes-grid">
      @for (i of [1, 2, 3, 4, 5, 6]; track i) {
        <div class="note-card skeleton-card color-yellow">
          <div class="note-header">
            <div class="skeleton skeleton-title"></div>
            <div class="note-actions">
              <div class="skeleton skeleton-icon"></div>
              <div class="skeleton skeleton-icon"></div>
            </div>
          </div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text" style="width: 80%;"></div>
          <div class="skeleton skeleton-text" style="width: 60%;"></div>
          <div class="note-footer">
            <div class="skeleton skeleton-date"></div>
          </div>
        </div>
      }
    </div>
  }

  @if (error()) {
    <div class="state-container error">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#A4193D" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <p>{{ error() }}</p>
      <p class="error-hint">Verifica que Firebase esté configurado correctamente</p>
      <button (click)="retry()" class="btn btn-primary">Reintentar</button>
    </div>
  }

  @if (!isLoading() && !error() && notes().length === 0) {
    <div class="state-container">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
      </svg>
      <p>No hay notas</p>
      <p class="empty-hint">Crea tu primera nota con el botón de arriba</p>
    </div>
  }

  @if (!isLoading() && !error() && notes().length > 0) {
    <div class="notes-grid">
      @for (note of notes(); track note.id) {
        <div class="note-card" [class]="getColorClass(note.color)">
          <div class="note-header">
            <h3 class="note-title">{{ note.title }}</h3>
            <div class="note-actions">
              <button class="btn-icon" title="Editar" (click)="openEditModal(note)">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
              <button class="btn-icon delete" title="Eliminar" (click)="deleteNote(note)">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </div>
          </div>
          <p class="note-content">{{ note.content }}</p>
          <div class="note-footer">
            <span class="note-date">
              {{ note.updatedAt | date:'dd/MM/yyyy HH:mm' }}
            </span>
          </div>
        </div>
      }
    </div>
  }

  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ editingNote() ? 'Editar Nota' : 'Nueva Nota' }}</h2>
          <button class="btn-close" (click)="closeModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Título</label>
            <input
              type="text"
              [value]="formData().title"
              (input)="updateField('title', $any($event.target).value)"
              placeholder="Título de la nota"
            />
          </div>
          <div class="form-group">
            <label>Contenido</label>
            <textarea
              [value]="formData().content"
              (input)="updateField('content', $any($event.target).value)"
              placeholder="Escribe tu nota aquí..."
              rows="5"
            ></textarea>
          </div>
          <div class="form-group">
            <label>Color</label>
            <div class="color-picker">
              @for (color of colors; track color) {
                <button
                  type="button"
                  class="color-option"
                  [class]="getColorClass(color)"
                  [class.selected]="formData().color === color"
                  (click)="selectColor(color)"
                >
                  @if (formData().color === color) {
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  }
                </button>
              }
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()" [disabled]="isSaving()">Cancelar</button>
          <button class="btn btn-primary" (click)="saveNote()" [disabled]="!formData().title.trim() || isSaving()">
            @if (isSaving()) {
              <span class="btn-spinner"></span>
              Guardando...
            } @else {
              {{ editingNote() ? 'Guardar' : 'Crear' }}
            }
          </button>
        </div>
      </div>
    </div>
  }
</div>
